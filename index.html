<!DOCTYPE html>
<html>
<!-- Program exported to HTML using the KA Project Exporter by @MushyAvocado 
https://www.khanacademy.org/computer-programming/ka-project-exporter/5195486791385088
-->
	
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<title>Harikoa</title>
	<style>
		
		
		/* Change the color as you want */
		:root {
			--background-color: #000000;
		}
		
		
		html, body, #wrapper {
			overflow: hidden;
			width: 100%;
		    height: 100%;
			margin: 0px;
			padding: 0px;
		    width: calc(100% + 1px);
		}
		
		body {
		    background-color: var(--background-color);
		}
		
		
		canvas {
			width: fit-content;
			height: fit-content;
		}
		
		canvas:focus {
			outline: none;
		}
		
		/* Automatically fits to the remaining height and centers the canvas it contains */
		#wrapper {
			padding: 0px;
			margin: 0px;
			display: flex;
			justify-content: center;
			align-items: center;
			width: 100%;
		}
		
</style>
</head>
<body id="wrapper">
    <!-- Canvases with a class of "sketch" are applied to the program in the order importPJS() is called. -->
    <canvas class="sketch"></canvas>
	<!-- Load the PJS library -->
	<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/Khan/processing-js@master/processing.js"></script>
	<!-- The exporter script must be loaded before the program script -->
	<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/Mushy-Avocado/KA-exporter@main/exporter.js"></script>
	<!-- Run Khan Academy program and import PJS -->
	<script type="application/javascript">
		
		
		function program() {
		    
		    title("Harikoa");
		    size(600, 600);
		    
		    // All code goes here
			
			var rotSpeed,
			antiRotSpeed,
			backgrounds,
			button1,
			button2,
			transitionY,
			mapHeight,
			player;//Key variables for the game
			var scene=0;
			var AntitransitionY=0;
			var keys=[];
			var blocks=[];
			var fishies=[];
			var fps=60;
			var cam={
			};//Some more key variables
			var worldMap=[
			    '                                                                         B     B     B     B                                                                                                                                                        ',
			    '                                                                       B     B     B     B                                                                                                                                                          ',
			    '                                                                     B     B   X B     B                                                                                                                                                            ',
			    '                                                                   B     B     B     B     B                                                                                                                                                        ',
			    '                                                                 B   X B     B     B     B                                                                                                                                                          ',
			    '                                      SSS                            B     B     B     B                                                                                                                                                            ',
			    '                                          c   CCCCCCCCC       c    B     B     B     B     B                                                                                                                                                        ',
			    '                                 B  BBXXXBBBB            BBBXXB  B     B   X             B  P                                                                                                                                                       ',
			    '                                 BSBB                   BB    BXXX X B   X B     B  B  BB   cB                                                                                                                                                      ',
			    '                                 BSB                          BXXX B   X B     BXXXXXXXXXXXXBB                                                                                                                                                      ',
			    'BBBB                             BSB                          BBBB     B     B BXBXBBBBBBBBXBB                                                                                                                                                      ',
			    'BP     BBB               CCC     BSB                               X B     B XXXXBXXXBBBXBBXBB                                                                                                                                                      ',
			    'BBBBBB B   c B B BXX c   CCC     BSB                               B B BXB X XXBBBBBXBBBXBBXBB                                                                                                                                                      ',
			    '         BBB B B B   BBB     B   BSB                                          X     X   X  X                                                                                                                                                        ',
			    '             BXBXB  BB       B   BSB                                          X         X  X                                                                                                                                  SCCC                  ',
			    '             BBBBB           B   BSB                                          X            X                                                                                                                      CCCCC      S     CC               ',
			    '               B             B    SB                                                                                                                                                              c              B      B   S          c            ',
			    '               B             BBBBBBB                                                                                                                                                             SBBBXXBXX     BXXXXXXXBBBBBBXXXXXXXXBBBBXXBBXXBBXXB',
			    '               B                                                                                                                                                                                 S           B                                      ',
			    '               B                                                                                                                                                                                 S        BB                                        ',
			    '               B                                                                                                                                                                                 S                                                  ',
			    '                                                                                                                                                                                                 S                                                  ',
			    '                                                                                                                                                                                                 S                                                  ',
			    '                                                                                                                                                                                                 S                                                  ',
			    '                                                                                                                                                                                                 S                                                  ',
			    '                                                                                                                                                                                                 S                                                  ',
			    '                                                                                                    c                                                                                            S                                                  ',
			    '                                                                                           SSSSSSSSSB                                                                                            S                                                  ',
			    '                                                                                                      B                                                                                          S                                                  ',
			    '                                                                                                        B                                                                                        S                                                  ',
			    '                                                                                                          B                                                                                      S                                                  ',
			    '                                                                                                            B                                                                                    S                                                  ',
			    '                                                                                                              B                                                                                  S                                                  ',
			    '                                                                                                                B   B                                                  BBBBXXXXXXXXXXXXXXXXB     S                                                  ',
			    '                                                                                                                       BBB                                             B  SC               B     S                                                  ',
			    '                                                                                                                XXXBBB                 C  C  CC                        B  SC       C       B     S                                                  ',
			    '                                                                                                                             BBBS S S S  S  S                          B  SC  S S S  CSC   B     S                                                  ',
			    '                                                                                                                             BBB                 c   XXXXXXXX          B  SXXXXXXXXXXSSX         S                                                  ',
			    '                                                                                                                                                 B         CC          B  SXXXXXXXXXXXXX     CCCCS                                                  ',
			    '                                                                                                                                               XBB  S S S cCC X        B   XXXXXXXXXXXXX                                                            ',
			    '                                                                                                                                                    XXXXX BB  C        B SBXXXXXXXXXXXXX SBB                                                        ',
			    '                                                                                                                                                              C  X     B SSC      CC     SXB                                                        ',
			    '                                                                                                                                                              X  C     B  SCCCCCCS   CCCCSXB                                                        ',
			    '                                                                                                                                                                 C  XXXB  SC             SXB                                                        ',
			    '                                                                                                                                                                 X  C     SBXXXXXXXXXXXXXXXB                                                        ',
			    '                                                                                                                                                                    C  c  SB                                                                        ',
			    '                                                                                                                                                                    XBBBXXXB                                                                        ',
			    '                                                                                                                                                                                                                                                    ',
			    '                                                                                                                                                                                                                                                    ',
			    '                                                                                                                                                                                                                                                    ',
			    '                                                                                                                                                                                                                                                    ',
			    '                                                                                                                                                                                                                                                    ',
			    '                                                                                                                                                                                                                                                    ',
			    '                                                                                                                                                                                                                                                    ',
			    '                                                                                                                                                                                                                                                    ',
			    '                                                                                                                                                                                                                                                    ',
			    '                                                                                                                                                                                                                                                    ',
			    '                                                                                                                                                                                                                                                    ',
			    '                                                                                                                                                                                                                                                    ',
			    '                                                                                                                                                                                                                                                    ',
			    '                                                                                                                                                                                                                                                    ',
			];// The array of text for the map, you know what I'm talking about
			
			function Player(x,y){
			    //Some basic stuff for the player
			    this.x=x;
			    this.y=y;
			    this.Sz=20;
			    this.feeding=false;
			    this.accel=5;
			    this.speed=0;
			    this.falling=true;
			    this.jumpHeight=9.7;
			    this.hitPortal=false;
			    this.respawn={
			      x:this.x,
			      y:this.y
			    };
			    this.yvel=0;
			    this.gravity=0.8;
			    this.update=function(blocks){
			        //Checking to press z, r, or the arrow keys
			        if(keys[90]){
			          this.feeding=true;
			        }else{
			          this.feeding=false;
			        }
			        if(keys[LEFT]){
			            this.speed=-this.accel;
			        }
			        if(keys[RIGHT]){
			            this.speed=this.accel;
			        }
			        if(!keys[LEFT]&&!keys[RIGHT]){
			          this.speed=0;
			        }
			        if(keys[UP]&&!this.falling){
			          this.yvel=-this.jumpHeight;
			        }
			        if(keys[82]){
			          this.x=this.respawn.x;
			          this.y=this.respawn.y;
			          this.yvel=0;
			          this.inverted=false;
			        }
			        if(this.y>mapHeight+height){
			          this.x=this.respawn.x;
			          this.y=this.respawn.y;
			          this.yvel=0;
			        }
			        this.x+=this.speed;
			        this.collideWith(this.speed,0,blocks);
			        this.y+=this.yvel;
			        this.yvel+=this.gravity;
			        this.falling=true;
			        this.accel=5;
			        //this.feeding=false;
			        this.collideWith(0,this.yvel,blocks);
			    };
			    //Thomas L's collideWith function with my necessary change to     it
			    this.collideWith=function(xv,yv,blocks){
			        for(var i=0;i<blocks.length;i++){
			          var b=blocks[i];
			          if(this.y+this.Sz > b.y &&
			              this.y        < b.y+b.Sz &&
			              this.x+this.Sz > b.x &&
			              this.x        < b.x+b.Sz){
			                //Below, this checks for collision, and has an                    effect based on it's type
			                switch(b.type){
			                  case 1:
			                    if(yv>0) {
			                      this.yvel = 0;
			                      this.falling = false;
			                      this.y = b.y-this.Sz;
			                  }
			                  // TOP
			                  if(yv<0) {
			                      this.yvel = 0;
			                      this.falling = true;
			                      this.y = b.y+b.Sz;
			                  }
			                  // RIGHT
			                  if(xv>0) {
			                      this.speed = 0;
			                      this.x = b.x-this.Sz;
			                  }
			                  // LEFT
			                  if(xv<0) {
			                      this.speed = 0;
			                      this.x = b.x+b.Sz;
			                  }
			                  break;
			                  case 2:
			                    this.x=this.respawn.x;
			                    this.y=this.respawn.y;
			                    this.yvel=0;
			                  break;
			                  case 3:
			                    this.yvel=1;
			                    this.accel=10;
			                    //this.falling=false;
			                  break;
			                  case 4:
			                    this.yvel=-4;
			                  break;
			                  case 5:
			                    b.flagOn=true;
			                    this.respawn.x=b.x;
			                    this.respawn.y=b.y;
			                  break;
			                }
			          }
			        }
			    };
			    //Too generic, I might add eyes later to the show function    
			    this.show=function(){
			        colorMode(RGB,255,255,255,255);
			        noStroke();
			        fill(0,0,0,50);
			        rect(this.x+5,this.y+5,this.Sz,this.Sz);
			        fill(255, 174, 0);
			        rect(this.x,this.y,this.Sz,this.Sz);
			        stroke(0);
			        strokeWeight(2);
			        strokeCap(ROUND);
			        //noStroke();
			        //line();
			    };
			}
			function Block(x,y,type,type2){
			    this.x=x;
			    this.y=y;
			    this.type=type;
			    this.type2=type2;
			    this.Sz=50;
			    this.currentAni=this.Sz;
			    this.currentTrans=255;
			    this.currentAlphaSpeed=5;
			    this.flagRotation=random(-180/3,180/3);
			    this.flagOn=false;
			    this.animate=function(){
			        switch(this.type){
			            case 3:
			            this.currentAni=lerp(this.currentAni,0,0.05);
			            if(dist(this.currentAni,0,0,0)<1){
			                this.currentAni=this.Sz;
			            }
			            this.currentTrans+=this.currentAlphaSpeed;
			            if(this.currentTrans>255){
			                this.currentAlphaSpeed=-5;
			            }
			            if(this.currentTrans<0){
			                this.currentAlphaSpeed=5;
			            }
			            break;
			            case 4:
			            this.currentAni=lerp(this.currentAni,0,0.05);
			            if(dist(this.currentAni,0,0,0)<1){
			                this.currentAni=this.Sz;
			            }
			            this.currentTrans+=this.currentAlphaSpeed;
			            if(this.currentTrans>255){
			                this.currentAlphaSpeed=-5;
			            }
			            if(this.currentTrans<0){
			                this.currentAlphaSpeed=5;
			            }
			            break;
			            case 5:
			                if(this.flagOn){
			                    this.flagRotation=lerp(this.flagRotation,0,0.05);
			                }
			            break;
			        }
			    };
			    this.show=function(){
			        colorMode(RGB,255,255,255,255);
			        switch(this.type){
			            case 1:
			                switch(this.type2){
			                    case 1:
			                        noStroke();
			                        fill(0,0,0,50);
			                        rect(this.x+5,this.y+5,this.Sz,this.Sz);
			                        fill(0,119,182);
			                        strokeWeight(1);
			                        stroke(0,119,182);
			                        rect(this.x,this.y,this.Sz,this.Sz);
			                    break;
			                    case 2:
			                        noStroke();
			                        fill(0,0,0,50);
			                        rect(this.x+5,this.y+5,this.Sz,this.Sz);
			                        fill(30);
			                        strokeWeight(1);
			                        stroke(30);
			                        rect(this.x,this.y,this.Sz,this.Sz);
			                    break;
			                }
			            break;
			            case 2:
			                noStroke();
			                fill(0,0,0,50);
			                rect(this.x+5,this.y+5,this.Sz,this.Sz);
			                strokeWeight(1);
			                stroke(255,124,127);
			                fill(255,124,127);
			                rect(this.x,this.y,this.Sz,this.Sz);
			            break;
			            case 3:
			                strokeCap(SQUARE);
			                strokeWeight(5);
			                stroke(255,255,255,this.currentTrans);
			                for(var i=0;i<4;i++){
			                    line(this.x,this.y+i*this.Sz/4,this.x+this.Sz-this.currentAni,this.y+i*this.Sz/4);
			                }
			            break;
			            case 4:
			                strokeCap(SQUARE);
			                strokeWeight(5);
			                stroke(255,255,255,this.currentTrans);
			                for(var i=0;i<4;i++){
			                    line(this.x+i*this.Sz/4+7,this.y+this.currentAni,this.x+i*this.Sz/4+7,this.y+this.Sz);
			                }
			            break;
			            case 5:
			                strokeCap(SQUARE);
			                strokeWeight(5);
			                stroke(0);
			                pushMatrix();
			                translate(this.x+this.Sz/2,this.y+this.Sz);
			                rotate(this.flagRotation);
			                line(0,0,0,-this.Sz);
			                fill(133, 255, 167);
			                //noStroke();
			                triangle(0,-50,25,-20,0,-20);
			                popMatrix();
			            break;
			        }
			    };
			}
			function Fish(x,y,facing,feelings){
			    this.x=x;
			    this.y=y;
			    this.speedX=random(0,2);
			    this.speedY=random(-2,2);
			    this.faceChooser=round(random(1,2));
			    this.facing=facing;
			    this.feelings=feelings;
			    this.hue=random(0,360);
			    this.feelingsChooser=round(random(1,3));
			    this.update=function(player){
			        if(frameCount%60===0&&!player.feeding){
			            this.faceChooser=round(random(1,2));
			            this.speedY=random(-2,2);
			            this.speedX=random(0,2);
			        }
			        if(frameCount%600===0){
			            this.feelingsChooser=round(random(1,3));
			        }
			        switch(this.facing){
			            case "left":
			                this.x-=this.speedX;
			            break;
			            case "right":
			                this.x+=this.speedX;
			            break;
			        }
			        this.y+=this.speedY;
			        if(this.faceChooser===1){
			            this.facing="left";
			        }
			        if(this.faceChooser===2){
			            this.facing="right";
			        }
			        if(this.feelingsChooser===1){
			            this.feelings="sad";
			        }
			        if(this.feelingsChooser===2){
			            this.feelings="mediocre";
			        }
			        if(this.feelingsChooser===3){
			            this.feelings="happy";
			        }
			        if(player.feeding){
			            if(dist(this.x,this.y,player.x,player.x)<500){
			                this.feelings="happy";
			                    this.x=lerp(this.x,player.x,0.01);
			                if(this.x-player.x===0){
			                    this.facing="right";
			                }
			                this.y=lerp(this.y,player.y,0.01);
			            }
			        }
			        // if(this.x<0){
			        //     this.x=width;
			        // }
			        // if(this.x>width){
			        //     this.x=0;
			        // }
			        // if(this.y>height){
			        //     this.y=0;
			        // }
			        // if(this.y<0){
			        //     this.y=height;
			        // }
			    };
			    this.show=function(){
			        noStroke();
			        colorMode(HSB,360,100,100,100);
			        switch(this.facing){
			            case "left":
			                fill(0,0,0,25);
			                ellipse(this.x-40+5,this.y-5,50,50);
			                triangle(this.x-25+5,this.y-5,this.x+5,this.y-25-5,this.x+5,this.y+25-5);
			                fill(this.hue,60,100,100);
			                ellipse(this.x-40,this.y,50,50);
			                triangle(this.x-25,this.y,this.x,this.y-25,this.x,this.y+25);
			                noFill();
			                stroke(0);
			                strokeWeight(3);
			                strokeCap(ROUND);
			                line(this.x-56,this.y-10,this.x-56,this.y);
			                line(this.x-50,this.y-10,this.x-50,this.y);
			                switch(this.feelings){
			                    case "happy":
			                        arc(this.x-53,this.y+5,7,7,0,180);
			                    break;
			                    case "mediocre":
			                        line(this.x-50,this.y+5,this.x-56,this.y+5);
			                    break;
			                    case "sad":
			                        arc(this.x-53,this.y+10,7,7,180,360);                        
			                    break;
			                }
			                break;
			                case "right":
			                fill(0,0,0,25);
			                ellipse(this.x-5,this.y-5,50,50);
			                triangle(this.x-15-5,this.y-5,this.x-40-5,this.y-25-5,this.x-40-5,this.y+25-5);
			                fill(this.hue,60,100,100);
			                ellipse(this.x,this.y,50,50);
			                triangle(this.x-15,this.y,this.x-40,this.y-25,this.x-40,this.y+25);
			                noFill();
			                stroke(0);
			                strokeWeight(3);
			                strokeCap(ROUND);
			                line(this.x+10,this.y-10,this.x+10,this.y);
			                line(this.x+16,this.y-10,this.x+16,this.y);
			                switch(this.feelings){
			                    case "happy":
			                        arc(this.x+13,this.y+5,7,7,0,180);
			                    break;
			                    case "mediocre":
			                        line(this.x+10,this.y+5,this.x+16,this.y+5);
			                    break;
			                    case "sad":
			                        arc(this.x+13,this.y+10,7,7,180,360);
			                    break;
			                }
			            break;
			        }
			    };
			}
			function Button(x,y,Sz,col,effect,type){
			    this.x=x;
			    this.y=y;
			    this.antiX=null;
			    this.antiY=null;
			    this.Sz=Sz;
			    this.col=col;
			    this.effect=effect;
			    this.type=type;
			    //this.anitY=this.y-this.Sz/5;
			    this.AntiSz1=this.Sz*1.25;
			    this.AntiSz2=this.Sz*1;
			    this.clicked=false;
			    this.update=function(){
			        if(dist(mouseX,mouseY,this.x,this.y)<this.Sz/2){
			            //console.log("ouch");
			            this.Sz=lerp(this.Sz,this.AntiSz1,0.05);
			            cursor('POINTER');
			            if(mouseIsPressed){
			                this.clicked=true;
			            }
			        }
			        if(dist(mouseX,mouseY,this.x,this.y)>=this.Sz/2){
			            //console.log("ouch");
			            this.Sz=lerp(this.Sz,this.AntiSz2,0.05);
			            cursor(ARROW);
			        }
			        if(this.antiX!==null){
			            this.x=lerp(this.x,this.antiX,0.05);
			        }
			        if(this.antiY!==null){
			            this.y=lerp(this.y,this.antiY,0.05);
			        }
			    };
			    this.show=function(){
			        colorMode(RGB,255,255,255,255);
			        switch(this.type){
			            case "play":
			                fill(this.col);
			                stroke(255);
			                strokeWeight(this.Sz/20);
			                ellipse(this.x,this.y,this.Sz,this.Sz);
			                fill(0, 119, 182);
			                triangle(this.x-this.Sz/10,this.y-3*this.Sz/10,this.x-this.Sz/10,this.y+3*this.Sz/10,this.x+this.Sz/4-this.Sz/10,this.y);
			            break;
			            case "intro":
			            break;
			        }
			    };
			}
			function Background(x,y,type){
			    this.x=x;
			    this.y=y;
			    this.type=type;
			    this.bubblesX=[];
			    this.bubblesY=[];
			    this.bubblesSz=[];
			    this.bubblesAng=[];
			    this.col=[0,119,182];
			    this.anticol=[0,119,182];
			    for(var i=0;i<10;i++){
			        this.bubblesX.push(random(0,width));
			        this.bubblesY.push(random(0,height));
			        this.bubblesSz.push(random(20,100));
			        this.bubblesAng.push(random(0,360));
			    }
			    this.s180keY=height;
			    this.CoralHeights=[];
			    this.AntiCoralHeights=[];
			    this.CoralHue=[];
			    this.AntiCoralHue=[];
			    this.CoralHeights2=[];
			    this.AntiCoralHue2=[];
			    this.CoralHue2=[];
			    this.AntiCoralHeights2=[];
			    for(var i=0;i<50;i++){
			        this.CoralHeights.push(random(50,200));
			        this.CoralHue.push(random(0,360));
			        this.AntiCoralHue.push(random(0,360));
			        this.AntiCoralHeights.push(random(50,200));
			        this.CoralHeights2.push(random(50,200));
			        this.CoralHue2.push(random(0,360));
			        this.AntiCoralHue2.push(random(0,360));
			        this.AntiCoralHeights2.push(random(50,200));
			        //this.CoralHeights.push(random(0,100));
			    }
			    this.update=function(){
			        for(var i=0;i<this.col.length;i++){
			            this.col[i]=lerp(this.col[i],this.anticol[i],0.05);
			        }
			        switch(this.type){
			            case 1:
			                for(var i=0;i<this.bubblesY.length;i++){
			                    this.bubblesY[i]-=1;
			                    if(this.bubblesY[i]+this.bubblesSz[i]/2<0){
			                        this.bubblesX[i]=random(0,width);
			                        this.bubblesY[i]=height+this.bubblesSz[i];
			                        this.bubblesSz[i]=random(20,100);
			                    }
			                    this.bubblesAng[i]+=180/180;
			                }
			            break;
			            case 2:
			                for(var i=0;i<this.bubblesY.length;i++){
			                    this.bubblesY[i]-=1;
			                    if(this.bubblesY[i]+this.bubblesSz[i]/2<0){
			                        this.bubblesX[i]=random(0,width);
			                        this.bubblesY[i]=height+this.bubblesSz[i];
			                        this.bubblesSz[i]=random(20,100);
			                    }
			                    this.bubblesAng[i]+=180/180;
			                }
			                this.s180keY=lerp(this.s180keY,0,0.05);
			                if(frameCount%30===0){
			                    //this.s180keY=random(0,50);
			                    for(var i=0;i<this.CoralHeights.length;i++){
			                        this.AntiCoralHeights[i]=random(50,200);
			                        this.AntiCoralHue[i]=random(360);
			                        this.AntiCoralHeights2[i]=random(50,200);
			                        this.AntiCoralHue2[i]=random(360);
			                    }
			                }
			                for(var i=0;i<this.CoralHue.length;i++){
			                    this.CoralHue[i]=lerp(this.CoralHue[i],this.AntiCoralHue[i],0.05);
			                    this.CoralHeights[i]=lerp(this.CoralHeights[i],this.AntiCoralHeights[i],0.05);
			                    this.CoralHue2[i]=lerp(this.CoralHue2[i],this.AntiCoralHue2[i],0.05);
			                    this.CoralHeights2[i]=lerp(this.CoralHeights2[i],this.AntiCoralHeights2[i],0.05);
			                }
			            break;
			            case 3:
			                this.s180keY=lerp(this.s180keY,-width/1.5,0.05);
			                if(frameCount%30===0){
			                    this.s180keY=this.s180keY;
			                    for(var i=0;i<this.CoralHeights.length;i++){
			                        this.AntiCoralHeights[i]=random(50,200);
			                        this.AntiCoralHue[i]=random(360);
			                        this.AntiCoralHeights2[i]=random(50,200);
			                        this.AntiCoralHue2[i]=random(360);
			                    }
			                }
			                for(var i=0;i<this.bubblesY.length;i++){
			                    this.bubblesY[i]-=1;
			                    if(this.bubblesY[i]+this.bubblesSz[i]/2<0){
			                        this.bubblesX[i]=random(0,width);
			                        this.bubblesY[i]=height+this.bubblesSz[i];
			                        this.bubblesSz[i]=random(20,100);
			                    }
			                    this.bubblesAng[i]+=180/180;
			                }
			            break;
			        }
			    };
			    this.show=function(){
			        switch(this.type){
			            case 1:
			            colorMode(RGB,255,255,255,255);
			                this.anticol=[0,119,182];
			                noStroke();
			                fill(this.col[0],this.col[1],this.col[2]);
			                rect(this.x,this.y,width,height);
			                for(var i=0;i<this.bubblesX.length;i++){
			                    stroke(255);
			                    strokeCap(ROUND);
			                    strokeWeight(10);
			                    fill(255,255,255,50);
			                    ellipse(this.bubblesX[i],this.bubblesY[i],this.bubblesSz[i],this.bubblesSz[i]);
			                    noFill();
			                    strokeWeight(this.bubblesSz[i]/10);
			                    arc(this.bubblesX[i],this.bubblesY[i],this.bubblesSz[i]*0.5,this.bubblesSz[i]*0.5,this.bubblesAng[i],this.bubblesAng[i]+180/2);
			                }
			            break;
			            case 2:
			                this.anticol=[2,62,138];
			                noStroke();
			                colorMode(RGB,255,255,255,255);
			                fill(this.col[0],this.col[1],this.col[2]);
			                rect(this.x,this.y,width,height);
			                colorMode(HSB,360,100,100,100);
			                for(var i=0;i<this.CoralHeights2.length;i++){
			                    fill(this.CoralHue2[i],100,100,100);
			                    rect(i*57.3+50,height/2-this.CoralHeights2[i]+20+this.s180keY,20,this.CoralHeights2[i]);
			                    fill(206, 100, 75,70);
			                    rect(i*57.3+50,height/2-this.CoralHeights2[i]+20+this.s180keY,20,this.CoralHeights2[i]);
			                }
			                colorMode(RGB,255,255,255,255);
			                fill(2*1.1,62*1.1,138*1.1);
			                beginShape();
			                vertex(0,height);
			                for(var i=0;i<15;i++){
			                    if(i%2===1){
			                        vertex(i*width/10,height/2-20+this.s180keY);
			                    }
			                    else{
			                        vertex(i*width/10,height/2+this.s180keY);
			                    }
			                }
			                vertex(width,height);
			                colorMode(HSB,360,100,100,100);
			                endShape();
			                for(var i=0;i<this.CoralHeights.length;i++){
			                    fill(this.CoralHue[i],100,0,30);
			                    rect(i*57.3+10-5,height/2-this.CoralHeights[i]+20+this.s180keY-5,20,this.CoralHeights[i]);
			                    fill(this.CoralHue[i],100,100,100);
			                    rect(i*57.3+10,height/2-this.CoralHeights[i]+20+this.s180keY,20,this.CoralHeights[i]);
			                }
			                colorMode(RGB,255,255,255,255);
			                for(var i=0;i<this.bubblesX.length;i++){
			                    stroke(255);
			                    strokeCap(ROUND);
			                    strokeWeight(10);
			                    fill(255,255,255,50);
			                    ellipse(this.bubblesX[i],this.bubblesY[i],this.bubblesSz[i],this.bubblesSz[i]);
			                    noFill();
			                    strokeWeight(this.bubblesSz[i]/10);
			                    arc(this.bubblesX[i],this.bubblesY[i],this.bubblesSz[i]*0.5,this.bubblesSz[i]*0.5,this.bubblesAng[i],this.bubblesAng[i]+180/2);
			                }
			            break;
			            case 3:
			                this.anticol=[20,20,20];
			                noStroke();
			                colorMode(RGB,255,255,255,255);
			                fill(this.col[0],this.col[1],this.col[2]);
			                rect(this.x,this.y,width,height);
			                colorMode(HSB,360,100,100,100);
			                for(var i=0;i<this.CoralHeights2.length;i++){
			                    fill(this.CoralHue2[i],100,100,100);
			                    rect(i*57.3+50,height/2-this.CoralHeights2[i]+20+this.s180keY,20,this.CoralHeights2[i]);
			                    fill(206, 100, 75,70);
			                    rect(i*57.3+50,height/2-this.CoralHeights2[i]+20+this.s180keY,20,this.CoralHeights2[i]);
			                }
			                colorMode(RGB,255,255,255,255);
			                fill(this.col[0]-10,this.col[1]-10,this.col[2]-10);
			                beginShape();
			                vertex(0,height);
			                for(var i=0;i<15;i++){
			                    if(i%2===1){
			                        vertex(i*width/10,height/2-20+this.s180keY);
			                    }
			                    else{
			                        vertex(i*width/10,height/2+this.s180keY);
			                    }
			                }
			                vertex(width,height);
			                colorMode(HSB,360,100,100,100);
			                endShape();
			                for(var i=0;i<this.CoralHeights.length;i++){
			                    fill(this.CoralHue[i],100,0,30);
			                    rect(i*57.3+10-5,height/2-this.CoralHeights[i]+20+this.s180keY-5,20,this.CoralHeights[i]);
			                    fill(this.CoralHue[i],100,100,100);
			                    rect(i*57.3+10,height/2-this.CoralHeights[i]+20+this.s180keY,20,this.CoralHeights[i]);
			                }
			                colorMode(RGB,255,255,255,255);
			                for(var i=0;i<this.bubblesX.length;i++){
			                    stroke(20);
			                    strokeCap(ROUND);
			                    strokeWeight(10);
			                    fill(20,20,20,50);
			                    ellipse(this.bubblesX[i],this.bubblesY[i],this.bubblesSz[i],this.bubblesSz[i]);
			                    noFill();
			                    strokeWeight(this.bubblesSz[i]/10);
			                    arc(this.bubblesX[i],this.bubblesY[i],this.bubblesSz[i]*0.5,this.bubblesSz[i]*0.5,this.bubblesAng[i],this.bubblesAng[i]+180/2);
			                }
			            break;
			        }
			    };
			}
			//var rotSpeed=180/180;
			var endingX=2000;
			var Deepener=1200;
			
			function Load(set,map){
			    for(var i=0;i<map.length;i++){
			        for(var j=0;j<map[i].length;j++){
			            var id=map[i][j];
			            switch(id){
			                case 'B':
			                    set.push(new Block(j*50,i*50,1,1));
			                break;
			                case 'X':
			                    set.push(new Block(j*50,i*50,2));
			                break;
			                case 'C':
			                    set.push(new Block(j*50,i*50,3));
			                break;
			                case 'S':
			                    set.push(new Block(j*50,i*50,4));
			                break;
			                case 'P':
			                    player.x=j*50;
			                    player.y=i*50;
			                    player.respawn.x=j*50;
			                    player.respawn.y=i*50;
			                break;
			                case 'c':
			                    set.push(new Block(j*50,i*50,5));
			                break;
			            }
			        }
			    }
			}
			function menu(){
			    backgrounds.type=1;
			    backgrounds.update();
			    backgrounds.show();
			    button1.update();
			    button1.show();
			    strokeCap(SQUARE);
			    strokeWeight(20);
			    stroke(255);
			    noFill();
			    arc(width/2,height/4,100,100,2*180/8+rotSpeed,14*180/8+rotSpeed);
			    //strokeWeight(10);
			    arc(width/2,height/4,50,50,2*180/8,14*180/8);
			    rotSpeed=lerp(rotSpeed,antiRotSpeed,0.05);
			    if(dist(0,rotSpeed,0,antiRotSpeed)<5){
			        antiRotSpeed+=360;
			    }
			}
			function game(){
			    cam.x=lerp(cam.x,width/2-player.x,0.05);
			    cam.y=lerp(cam.y,height/2-player.y,0.05);
			    //button2.y=-25;
			    button2.antiY=25;
			    backgrounds.type=2;
			    backgrounds.update();
			    backgrounds.show();
			    button2.update();
			    button2.show();
			    pushMatrix();
			    translate(cam.x,cam.y);
			    for(var i=0;i<fishies.length;i++){
			        fishies[i].update(player);
			        fishies[i].show();
			        if(fishies.length>250){
			            fishies.splice(random(0,fishies.length-1),1);
			        }
			    }
			    player.update(blocks);
			    player.show();
			    for(var i=0;i<blocks.length;i++){
			    blocks[i].animate();
			    blocks[i].show();
			    blocks[i].type2=1;
			    }
			    textFont(createFont("Arial Black"), 24);
			    fill(255);
			    text("Just Fall, don't move", 4700, 450);
			    popMatrix();
			    if(round(random(0,20))===0){
			        fishies.push(new Fish(random(-20000,20000),random(-height*3,height+mapHeight),"left","sad"));
			    }
			    if(player.y>Deepener&&player.x>4400){
			        scene=3;
			    }
			    if(player.x>12240){
			        scene=4;
			    }
			}
			function inTheDeep(){
			    cam.x=lerp(cam.x,width/2-player.x,0.05);
			    cam.y=lerp(cam.y,height/2-player.y,0.05);
			    //button2.y=-25;
			    button2.antiY=25;
			    backgrounds.type=3;
			    backgrounds.update();
			    backgrounds.show();
			    button2.update();
			    button2.show();
			    pushMatrix();
			    translate(cam.x,cam.y);
			    for(var i=0;i<fishies.length;i++){
			        fishies[i].update(player);
			        fishies[i].show();
			        if(fishies.length>250){
			            fishies.splice(random(0,fishies.length-1),1);
			        }
			    }
			    player.update(blocks);
			    player.show();
			    for(var i=0;i<blocks.length;i++){
			    blocks[i].animate();
			    blocks[i].show();
			    blocks[i].type2=2;
			    }
			    textFont(createFont("Arial Black"), 24);
			    fill(255);
			    text("Just Fall, don't move", 4700, 450);
			    popMatrix();
			    if(player.y<Deepener){
			        scene=1;
			    }
			    if(round(random(0,20))===0){
			        fishies.push(new Fish(random(-20000,20000),random(-height*3,height+mapHeight),"left","sad"));
			    }
			}
			function Ending(){
			    button2.antiY=25;
			    backgrounds.type=2;
			    backgrounds.update();
			    backgrounds.show();
			    button2.update();
			    button2.show();
			    for(var i=0;i<fishies.length;i++){
			        fishies[i].update(player);
			        fishies[i].show();
			        if(fishies.length>250){
			            fishies.splice(random(0,fishies.length-1),1);
			        }
			    }
			    strokeCap(SQUARE);
			    strokeWeight(50);
			    stroke(0,0,360);
			    noFill();
			    arc(width/2+endingX,height/2,height/2,height/2,2*180/8+rotSpeed,14*180/8+rotSpeed);
			    //strokeWeight(10);
			    arc(width/2+endingX,height/2,height/4,height/4,2*180/8,14*180/8);
			    rotSpeed=lerp(rotSpeed,antiRotSpeed,0.05);
			    if(dist(0,rotSpeed,0,antiRotSpeed)<5){
			        antiRotSpeed+=360;
			    }
			    fill(0,0,360);
			    textFont(createFont("Arial Black"), 24);
			    noStroke();
			    text("Please reload the site to play again",width/9,height*5/6);
			    endingX=lerp(endingX,0,0.05);
			}
			function keyPressed(){
			  keys[keyCode]=true;
			}
			function keyReleased(){
			  keys[keyCode]=false;
			}
			//var font;
			//function setup() {
			  smooth();
			  //song=loadSound('Beep-Beep.mp3',ok);
			  rotSpeed=180/180;
			  antiRotSpeed=360;
			  //createCanvas(windowWidth,windowHeight);
			  //font=loadFont('ariblk.ttf');
			  player=new Player(200,200);
			  AntitransitionY=height*2;
			  button1=new Button(width/2,3*height/4.5,width*200/1011,color(0, 119*0.8, 182*0.8),game,"play");
			  button2=new Button(25,-25,50,color(0,180,216),menu,"play");
			  backgrounds=new Background(0,0,1);
			cam.x=0;
			cam.y=0;
			for(var i=0;i<250;i++){
			  fishies.push(new Fish(random(-20000,20000),random(-1057*3,1057),"left","sad"));
			}
			mapHeight=worldMap.length*50;
			//blocks.push(new Block(200,300,1));
			Load(blocks,worldMap);
			//}
			function sceneSetter(s,button){
			  scene=s;
			  button.clicked=false;
			  cursor(ARROW);
			  transitionY=0;
			}
			function draw() {
			  frameRate(fps);
			  background(220);
			  switch(scene){
			    case 0:
			      menu();
			    break;
			    case 1:
			      game();
			    break;
			    case 3:
			      inTheDeep();
			    break;
			    case 4:
			      Ending();
			    break;
			  }
			  //menu();
			  //button1.show();
			  //rotSpeed+=180/180;
			  if(button1.clicked){
			    sceneSetter(1,button1);
			    //AntitransitionY=height*2;
			  }
			  if(button2.clicked){
			    sceneSetter(0,button2);
			  }
			  noStroke();
			  fill(0);
			  rect(0,-height+transitionY,width,height);
			  transitionY=lerp(transitionY,AntitransitionY,0.05);
			  //song.setLoop(true);
			}
			
		}
		
		runPJS(program);
		
		// Add reload button on KA --> <script>
		
	</script>
</body>

</html>
